Clever-Bank
============

    Банковское приложение (консольное / веб).
    Доступные функции:
    
        - пополнение счета
        - снятие денежных средст со счета
        - перевод денег со счета на счет
        - генерация чека в формате pdf
        - генерация выписки по операциям за конкретный период времени
    
    Используемые технологии:
    
            Основными требованиями к проекту были запрет использования Spring и Hibernate, 
    а также обязательное использование JDBC.

            В связи с этим, были использованы:
        
        - JDK 17
        - для сборки проекта - Gradle
        - для взаимодействия с БД - JDBC
        - БД - PostgreSQL
        - в качестве datasource - s3p0
        - для генерации pdf - itextpdf
        - веб часть приложения написана с использованием jakarta.servlet, tomcat 10.1.13
        - для валидации - jakarta.validation, org.apache.bval
        - для реализации АОП функций - AspectJ
        - иные библиотеки

Для приложения была использована следующая схема БД:
--------------------------------------------------
    
![](src/main/resources/views/schema.png)


Консольная версия
-----

Консольная версия приложения имеет ограниченный функционал.<br>

В частности, доступны только функции пополнения баланса / снятия денежных средств, перевод <br>
денег между счетами, генерация чека, логирование входных / выходных параметров сервисных методов.<br>

Для запуска консольной версии необходимо: <br>
    - клонировать репозиторий,<br>
    - в PostgreSQL создать базу данных 'CleverBank', <br>
    - создать необходимые таблицы, <br>
    - заполнить их дефолтными значениями.<br>
Приложение ожидает, что вышеуказанные операции уже будут выполнены. <br>
Для генерации таблиц и заполнения их дефолтными значениями можно использовать sql файл,<br>
находящийся в пакете resources/sql. <br>
Для подключения к БД приложение будет использовать логин - postgres, пароль - postgres. <br>

После настройки БД необходимо скомпилировать проект и запустить метод main, <br>
находящийся в классе src.main.java.by.home.Main. <br>
Приложение ожидает, что ему будут переданы аргументы коммандной строки. <br>
Должно были 2 или 3 аргумента, разделенные одним пробелом.
    
Возможные варианты аргументов:

    account amount

где параметр account должен соответствовать паттерну "^BY13[A-Z]{4}\d{20}$" - банковский счет,<br>
с которым будет производиться операция (пополнение / снятие); <br>
amount - сумма операции (не более 8 значащих чисел и двух чисел в дробной части).<br>
Пример валидного счета - "BY13CLVR00000000000000000000", валидной суммы - "1000.55". <br>
Банковский счет обязательно должен находиться в БД. <br>
Уже добавленные счета можно взять из sql файла. <br>
Сумма допускает как положительные значения, так и отрицательные. <br>
При передаче положительного значения будет произведено зачисление денег, <br>
при передаче отрицательного - снятие. <br>
Снятие невозможно, если на счете недостаточно для операции средств.

    account1 account2 amount

где параметр account1 - счет, с которого будет произведено снятие денежные средств,<br>
account2 - счет, на который будет произведено зачисление, <br>
amount - сумма операции (не более 8 значащих чисел и двух чисел в дробной части). <br>
Счета должны соответствовать паттерну "^BY13[A-Z]{4}\d{20}$". <br>
Пример валидного счета - "BY13CLVR00000000000000000000", валидной суммы - "1000.55". <br>
Банковские счета обязательно должены находиться в БД. <br>
Уже добавленные счета можно взять из sql файла. <br>
Сумма допускает только положительные значения. <br>
Перевод невозможен, если на первом счете недостаточно для операции средств.<br>

При успешном выполнении операции в консоль будет выведено сообщение "Operation successful complete".<br>
Одновременно с этим, в папку check в корне проекта будет помещен pdf файл с чеком проведенной операции.<br>
В файл logging.txt в корне проекта будет добавлена информация о вызовах сервисных методов.<br>

Веб версия
-------------------------------

В веб версии доступен весь функционал, доступный в консольной версии приложения. <br>

Кроме того, есть возможность воспользоваться дополнительными функциями, <br>
такими как получение сокращенной или подробной выписки по операциям <br>
за определенный период времени по определенному счету.<br>
Кроме того, в автоматическом режиме работает функция начисления процентов на остаток средств на счете. <br>
Начисление происходит в последний день каждого месяца, значение берется из property файла.<br>
Дефолтное значение - 1.<br>

Для запуска веб версии приложения необходимо клонировать репозиторий, <br>
после чего из консоли выполнить комманду 
    
    docker compose up

Для ее выполнения необходимо, чтобы была установлен Docker.<br>
После ввода данной команды будет поднят контейнер со всем необходимым для работы приложения.<br>

Для взаимодействия с базой данных можно воспользовать веб интерфейсом pgadmin.<br>
Доступ к нему осуществляется по адресу: <a href="http://localhost:82"> перейти к pgadmin</a> <br>
В качестве логина установлено значение - "mymail@mail.ru", в качестве пароля - "secretPassword" <br>
Логин для доступа к БД - "postgres", пароль - "postgres".

Приложение доступно по адресу: <a href="http://localhost:8082/clever-bank"> http://localhost:8082/clever-bank/ </a> <br>
Для взаимодействия с приложением доступны следующие эндпоинты <br>
(все указанные ниже адреса должны продолжать адрес приложения):

> POST /accounts/changeBalance?account=value&amount=value

Параметры account и amount являются обязательными, могут быть указаны в произвольном порядке. <br>
Account должен соответствовать паттерну "^BY13[A-Z]{4}\d{20}$" - банковский счет, <br>
с которым будет производиться операция(пополнение / снятие);<br>
amount - сумма операции (не более 8 значащих чисел и двух чисел в дробной части).<br>

Банковский счет обязательно должен находиться в БД. <br>
Уже добавленные счета можно взять из sql файла. <br>
Сумма допускает как положительные значения, так и отрицательные. <br>
При передаче положительного значения будет произведено зачисление денег, <br>
при передаче отрицательного - снятие. <br>
Снятие невозможно, если на счете недостаточно для операции средств. <br>

пример запроса: 
`http://localhost:8082/clever-bank/accounts/changeBalance?account=BY13CLVR00000000000000000000&amount=1000

> POST /accounts/transferMoney?account_from=value&account_to=value&amount=value

где параметр account_from - счет, с которого будет произведено снятие денежные средств, <br>
account_to - счет, на который будет произведено зачисление, <br>
amount - сумма операции (не более 8 значащих чисел и двух чисел в дробной части). <br>

Счета должны соответствовать паттерну "^BY13[A-Z]{4}\d{20}$". <br>
Банковские счета обязательно должены находиться в БД. <br>
Уже добавленные счета можно взять из sql файла. <br>
Сумма допускает только положительные значения. <br>
Перевод невозможен, если на первом счете недостаточно для операции средств.<br>

пример запроса:
`http://localhost:8082/clever-bank/accounts/transferMoney?account_from=BY13CLVR00000000000000000000&amount=1000&account_to=BY13CLVR00000000000000000001

> GET /transactions/statement?account=value&dateFrom=value&dateTo=value&detailed=value

где только параметр account является обязательным, остальные опциональные.<br>

Account должен соответствовать паттерну "^BY13[A-Z]{4}\d{20}$" - банковский счет, <br>
для которого будет сгенерирована выписка. <br>
Банковский счет обязательно должен находиться в БД. <br>
Уже добавленные счета можно взять из sql файла. <br>

Параметр detailed допускает boolean значения true / false. <br>
При передаче значения true будет сгенерирована подробная выписка, <br>
при передаче значения false будет сгенерирована общая выписка. <br>
Если параметр не будет передан, выбирается значение false. <br>

Параметры dateFrom и dateTo определяют временной промежуток, <br>
для которого будет генерироваться выписка. <br>
dateFrom - дата, с которой будут включаться транзакции в выписку, <br>
dateTo - дата, по которую включительно будут включаться транзакции в выписку. <br>
Оба параметра могут не передаваться. <br>
Дефолтное значение dateFrom - дата открытия счета, для которого формируется выписка,<br>
dateTo - дата формирования выписки. <br>
Обе даты должны соответствовать виду "2023-01-01". <br>

пример запроса:
`http://localhost:8082/clever-bank/transactions/statement?account=BY13CLVR00000000000000000001&dateFrom=2023-01-01&dateTo=2023-01-01&detailed=true

Если операция была выполнена успешно, будет возвращен код ответа 200 и сообщение "Operation successful complete".<br>
При некорректных входных параметрах будет возвращен код ответа 400 и сообщение о проблеме.<br>
Для операций, изменяющий баланс счета в папку check будет помещен pdf файл с чеком о проведенной операции. <br>
В файл logging.txt будет добавлена информация о вызовах сервисных методов. <br>
По всем операциям осуществляется логирование вызовов сервисных методов.

pdf файлы и файл логирования можно найти в Docker контейнере в файловой системе tomcat по пути: /usr/local/tomcat.<br>
Чеки хранятся в папке /check,<br>
выписки в папке /statement-money,<br>
логи в файле logging.txt<br>
Обратите внимание, что при просмотре pdf файлов через Docker возможнЫ проблемы с кодировкой. <br>
Во избежание этой проблемы pdf файлы необходимо сохранить на устройство. <br>

По всем возникшим вопросам можно писать по адресу maxamus_747@mail.ru 